<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Commercial Dehydrators Showcase</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; margin:0; padding: 0 0 2em 0;}
    h1 { text-align: center; }
    .container { max-width: 1100px; margin: 2em auto 0 auto; }
    .product-list { display: flex; flex-wrap: wrap; gap: 24px; justify-content: center; }
    .product-item {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
      width: 280px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px 12px 20px 12px;
      position: relative;
      margin-bottom: 16px;
    }
    .product-item img { width: 190px; height: 190px; object-fit: contain; margin-bottom: 10px; }
    .product-item .name { font-size: 1.04em; font-weight: 600; margin: 0 0 6px 0; text-align:center;}
    .product-item .price { font-weight: bold; font-size: 1.1em; color: #b12704; margin-bottom: 2px; }
    .product-item .list-price { text-decoration: line-through; color: #888; font-size: 0.93em; margin-left: 6px;}
    .product-item .rating { margin: 6px 0 2px 0; color: #f2b01e; }
    .product-item .reviews { color: #555; font-size: 0.93em; margin-bottom: 4px; }
    .product-item .coupon, .product-item .promotion { color: #007600; font-size: 0.97em; margin: 2px 0;}
    .product-item .delivery-label, .product-item .delivery, .product-item .fastest-delivery { font-size: 0.93em; color: #222; }
    .product-item .stock-info { font-size: 0.9em; color: #b12704; }
    .product-item .badge { position: absolute; top: 16px; left: 16px; background: #ffd700; color: #222; font-size: 0.8em; padding: 2px 8px; border-radius: 4px; }
    .product-item .amazon-choice { background: #232f3e; color: #fff; }
    .product-item .link { margin-top: 8px; display: inline-block; background: #ffa41c; color: #111; padding: 7px 16px; border-radius: 5px; font-weight: 600; text-decoration: none;}
    .product-item .link:hover { background: #ff8c00; }
    @media (max-width: 850px) {
      .product-list { flex-direction: column; align-items: center; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Commercial Dehydrators</h1>
    <div id="productContainer" class="product-list"></div>
  </div>
  <script>
    // All products from both arrays, merged together
    const allRawProducts = [
      // "products"
      {
        id: "1",
        title: "BriSunshine Commercial Dehydrator, 20-Layer Food Dehydrator with Triple Fans, LED Light, 1600W, 24H Timer, Large Food Dehydrators for Homemade Jerky, Fruit, Pet Treat, Veggies, Stainless Steel",
        price: "599.79",
        image: "https://m.media-amazon.com/images/I/71Gn45M+knL._AC_UY218_.jpg",
        rating: 3.7,
        reviews: 7,
        link: "https://www.amazon.com/BriSunshine-Commercial-Dehydrator-20-Layer-Dehydrators/dp/B0DRVJZK9S/ref=sr_1_1_sspa",
        sponsored: true,
        coupon: "$60.00 off coupon applied",
        delivery: "FREE delivery Jun 11 - 27",
        fastest_delivery: "Jun 11 - 24",
        stock_info: "Add to cart"
      },
      {
        id: "2",
        title: "Rotary Food-Dehydrator Machine 16 Trays 17.52 Ft² Fruit-Dehydrator for Jerky 1500w Large Meat Dryer 190°F Stainless Steel Food Dryer Machine for Herbs, Beef, Mushrooms, Dog Treats",
        price: "389.99",
        list_price: "419.99",
        image: "https://m.media-amazon.com/images/I/71TeKi2hv7L._AC_UY218_.jpg",
        rating: 4.6,
        reviews: 45,
        link: "https://www.amazon.com/Food-Dehydrator-Machine-Fruit-Dehydrator-Stainless-Mushrooms/dp/B0F5HDX8MW/ref=sr_1_2_sspa",
        sponsored: true,
        delivery: "FREE delivery Jun 4 - 5",
        stock_info: "Only 10 left in stock - order soon. Add to cart"
      },
      {
        id: "3",
        title: "NutriChef 32 Layer & 2 Chamber Commercial Food Dehydrator Machine - Stainless Steel Trays, Digital Timer and Temperature Control, Ideal for Jerky Meat, Fruit, Pet Treats, Vegetables",
        price: "1517.99",
        image: "https://m.media-amazon.com/images/I/71UJehY+4nL._AC_UY218_.jpg",
        rating: 4.1,
        reviews: 466,
        link: "https://www.amazon.com/NutriChef-Chamber-Commercial-Dehydrator-Machine/dp/B0DTJBTNP6/ref=sr_1_3",
        delivery: "FREE delivery Mon, Jun 2",
        fastest_delivery: "Tomorrow, May 29",
        stock_info: "Only 16 left in stock (more on the way). Add to cart"
      },
      {
        id: "4",
        title: "Commercial Food Dehydrator 18 Trays, 1500W Large Capacity 34.42ft² Food Dryer Machine for Jerky, Meat, Fruit, Herbs, Full Stainless Steel Industrial Dehydrater Biltong Maker",
        price: "385.00",
        image: "https://m.media-amazon.com/images/I/71Fbr5RpC8L._AC_UY218_.jpg",
        rating: 4.4,
        reviews: 91,
        link: "https://www.amazon.com/Septree-Commercial-Dehydrator-Industrial-Temperature/dp/B0CD1XGTWL/ref=sr_1_4",
        amazon_choice: true,
        promotion: "5% off promotion available",
        delivery: "FREE delivery Sun, Jun 1",
        stock_info: "Only 12 left in stock - order soon. Add to cart"
      },
      {
        id: "5",
        title: "Commercial Food-Dehydrator Machine 22 Trays,37.5Large Dehydrator for Fruit 70ºF-190ºF,Twin 110V Plugs Beef Jerky Maker,Stainless Steel Food Dryer for Meat,Herbs, Mushroom,Freeze-dried Fruit",
        price: "559.99",
        image: "https://m.media-amazon.com/images/I/81RE28THoVL._AC_UY218_.jpg",
        rating: 4.6,
        reviews: 45,
        link: "https://www.amazon.com/Commercial-Food-Dehydrator-37-5Large-Dehydrator-70%C2%BAF-190%C2%BAF/dp/B0F3JL2N92/ref=sr_1_5",
        coupon: "5% off coupon applied",
        delivery: "FREE delivery Jun 4 - 5",
        stock_info: "Only 10 left in stock - order soon. Add to cart"
      },
      // "frequently_viewed"
      {
        id: "fv1",
        title: "Rotary Food Dehydrator 16 Trays, Commercial Large Rotating Food Dryer Machine for Jerky, Herbs, Mushrooms, Fruit, Dog Treats, 1500W Full Stainless Steel Industrial Dehydrater",
        price: "489.99",
        image: "https://m.media-amazon.com/images/I/71H8lTUDitL._AC_UL320_.jpg",
        rating: 5.0,
        reviews: 9,
        link: "https://www.amazon.com/Septree-Dehydrator-Commercial-Industrial-Dehydrater/dp/B0DZHFLPHP",
        sponsored: true,
        coupon: "$40.00 off coupon applied"
      },
      {
        id: "fv2",
        title: "SUCISENI Food Dehydrator Machine 800W 18 Trays Stainless Steel Commercial Food Dehydrated Dryer with 24H Timer Touch-Control LED Display, Compact Size for Home Jerky Herbs Meat Fruit",
        price: "219.99",
        image: "https://m.media-amazon.com/images/I/712wEvaI3jL._AC_UL320_.jpg",
        rating: 4.4,
        reviews: 159,
        link: "https://www.amazon.com/Commercial-Dehydrator-Dehydrated-Touch-Control-Protection/dp/B0CNBTD67J",
        sponsored: true,
        coupon: "$50.00 off coupon applied"
      },
      {
        id: "fv3",
        title: "12-Tray Food Dehydrator – 600W Adjustable Temperature (86°F-194°F) & Digital Timer, Quiet Operation, Ideal for Jerky, Fruits, Vegetables, Dog Treats, and Healthy Snacks",
        price: null,
        image: "https://m.media-amazon.com/images/I/81XLp2gELQL._AC_UL320_.jpg",
        rating: 4.1,
        reviews: 90,
        link: "https://www.amazon.com/VALONDINO-Dehydrators-Dehydrator-Control-Mushroom/dp/B0CXDHQMWT",
        sponsored: true
      }
    ];

    // Normalize to your function's expected structure, preserving all fields
    const allProducts = allRawProducts.map(p => ({
      ...p,
      name: p.title,
      offers: {
        price: p.price,
        url: p.link
      }
    }));

    // ---- Your exact renderProducts function, with correct product link logic ----
    function renderProducts(products) {
        const container = document.getElementById('productContainer');
        container.innerHTML = ""; // Clear previous content

        products.forEach(product => {
            const productItem = document.createElement('div');
            productItem.className = 'product-item';

            // Sponsored/Badge
            if (product.sponsored) {
                const badge = document.createElement('span');
                badge.className = 'badge';
                badge.textContent = 'Sponsored';
                productItem.appendChild(badge);
            }
            if (product.amazon_choice) {
                const badge = document.createElement('span');
                badge.className = 'badge amazon-choice';
                badge.textContent = 'Amazon Choice';
                productItem.appendChild(badge);
            }

            const img = document.createElement('img');
            img.src = product.image;
            img.alt = product.name;

            const nameDiv = document.createElement('div');
            nameDiv.className = 'name';
            nameDiv.textContent = product.name;

            // Price parsing and fallback handling
            let parsedPrice = 25; // default fallback
            try {
                let priceStr = product.offers.price ? product.offers.price.toString().replace(/[$₦,]/g, '').trim() : '';
                parsedPrice = parseFloat(priceStr);
                if (isNaN(parsedPrice)) {
                    parsedPrice = 25;
                    throw new Error('Price is not a valid number');
                }
            } catch (error) {
                console.error(`Failed to parse price for product ${product.name}:`, error);
            }

            const priceDiv = document.createElement('div');
            priceDiv.className = 'price';
            if (product.offers && product.offers.price) {
                priceDiv.textContent = '$' + ((parsedPrice * 1) + (parsedPrice * 10 * 0.30)).toFixed(2);
            } else {
                priceDiv.textContent = "N/A";
            }
            // List price, if present
            if (product.list_price) {
                const listPriceDiv = document.createElement('span');
                listPriceDiv.className = 'list-price';
                listPriceDiv.textContent = product.list_price;
                priceDiv.appendChild(listPriceDiv);
            }

            // Rating and reviews
            const ratingDiv = document.createElement('div');
            ratingDiv.className = 'rating';
            ratingDiv.textContent = product.rating ? `★ ${product.rating}` : '';

            const reviewsDiv = document.createElement('div');
            reviewsDiv.className = 'reviews';
            reviewsDiv.textContent = product.reviews ? `${product.reviews} reviews` : '';

            // Coupon/Promotion
            if (product.coupon) {
                const couponDiv = document.createElement('div');
                couponDiv.className = 'coupon';
                couponDiv.textContent = product.coupon;
                productItem.appendChild(couponDiv);
            }
            if (product.promotion) {
                const promoDiv = document.createElement('div');
                promoDiv.className = 'promotion';
                promoDiv.textContent = product.promotion;
                productItem.appendChild(promoDiv);
            }

            // Delivery info
            if (product.delivery) {
                const deliveryDiv = document.createElement('div');
                deliveryDiv.className = 'delivery';
                deliveryDiv.textContent = product.delivery;
                productItem.appendChild(deliveryDiv);
            }
            // Fastest delivery info
            if (product.fastest_delivery) {
                const fastestDiv = document.createElement('div');
                fastestDiv.className = 'fastest-delivery';
                fastestDiv.textContent = `Fastest: ${product.fastest_delivery}`;
                productItem.appendChild(fastestDiv);
            }

            // Delivery window (your assignment)
            const today = new Date();
            const minDeliveryDate = new Date(today);
            minDeliveryDate.setDate(today.getDate() + 3);
            const maxDeliveryDate = new Date(today);
            maxDeliveryDate.setDate(today.getDate() + 11);
            function formatDate(date) {
                return date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
            }
            const deliveryLabelDiv = document.createElement('div');
            deliveryLabelDiv.className = 'delivery-label';
            deliveryLabelDiv.textContent = `Delivery: ${formatDate(minDeliveryDate)} - ${formatDate(maxDeliveryDate)}`;

            // Stock info
            if (product.stock_info) {
                const stockDiv = document.createElement('div');
                stockDiv.className = 'stock-info';
                stockDiv.textContent = product.stock_info;
                productItem.appendChild(stockDiv);
            }

            // Product link (correct logic)
            const link = document.createElement('a');
            link.href = product.offers && product.offers.url
                ? product.offers.url
                : `details_uri.html?origin=usd&name=${encodeURIComponent(product.name)}&price=${encodeURIComponent(((parsedPrice * 1) + (parsedPrice * 10 * 0.30)).toFixed(2))}&image_url=${encodeURIComponent(product.image)}`;
            link.textContent = "View Product";
            link.target = "_blank";
            link.className = "link";

            // Image error fallback handler
            img.onerror = () => {
                img.src = "images/fallback.jpg";
                console.error(`Failed to load image: ${product.image}`);
            };

            productItem.appendChild(img);
            productItem.appendChild(nameDiv);
            productItem.appendChild(priceDiv);
            if (ratingDiv.textContent) productItem.appendChild(ratingDiv);
            if (reviewsDiv.textContent) productItem.appendChild(reviewsDiv);
            productItem.appendChild(deliveryLabelDiv);
            productItem.appendChild(link);

            container.appendChild(productItem);
        });
    }

    // ---- Render all products!
    renderProducts(allProducts);
  </script>
</body>
</html>
