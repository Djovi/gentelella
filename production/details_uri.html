<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title> 
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <header>
        <a href="https://www.rechainglobal.com">
            <img src="images/rechain.jpg" alt="Your Company Logo" class="logo">
        </a>
    </header>
    <h1>Product Details</h1>
    <div id="productDetails" class="product-details"></div>
     <script src="https://js.stripe.com/v3/"></script> <!-- Load Stripe.js first -->
    <script>
        // Function to get query parameters
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                name: params.get('name'),
                price: params.get('price'),
                image_url: params.get('image_url')
            };
        }

        // Function to render product details
        function renderProductDetails(product) {
            const container = document.getElementById('productDetails');
            
            const img = document.createElement('img');
            img.src = product.image_url;
            container.appendChild(img);
            
            const name = document.createElement('div');
            name.className = 'name';
            name.textContent = product.name;
            container.appendChild(name);
            
            const price = document.createElement('div');
            price.className = 'price';
            price.textContent = parseFloat(product.price.replace('$', '')) * 1.8;
            container.appendChild(price);
            
            const buyButton = document.createElement('a');
            buyButton.className = 'buy-button';
            buyButton.href = `#`;
            buyButton.textContent = 'Buy Now';
            container.appendChild(buyButton);
            return buyButton;
        }

        // Fetch product details from query parameters
        const product = getQueryParams();
        const buyButton = renderProductDetails(product);

        const stripe = Stripe('pk_live_fgMxvyvoSrhEGCMCNixTpD7R'); // Replace with your Stripe publishable key

        async function createCheckoutSession(name, price, image) {
            const response = await fetch('/.netlify/functions/createCheckoutSession', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: name,
                    price: parseFloat(price.replace('$', '')) * 100, // Convert price to cents
                    image: image
                })
            });

            const session = await response.json();
            return session.id;
        }

        async function redirectToCheckout(sessionId) {
            const result = await stripe.redirectToCheckout({
                sessionId: sessionId
            });

            if (result.error) {
                console.error(result.error.message);
            }
        }

        // Event listener for Buy Now button
        buyButton.addEventListener('click', async () => {
            const sessionId = await createCheckoutSession(product.name, product.price, product.image_url);
            await redirectToCheckout(sessionId);
        });
    </script>
    <script src="script.js"></script> 
</body>
</html>
